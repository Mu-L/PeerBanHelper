import{E as z,F as J,a as A,u as I,g as M,h as q,_ as K}from"./index-DgHngGDW.js";import{f as B,a7 as W,s as _,k as p,t as a,y as l,m as F,n as Q,a3 as f,a as y,r as X,c as N,a9 as Y,I as Z,u as U,j as ee,F as te,P as oe,v,x as b}from"./libs-BYIN-Nlk.js";import{y as ae,aN as se,e as le,G as ne,H as re,v as ce,S as ie,c as ue,J as de,n as pe,m as he,T as fe,M as L}from"./arcoDesign-CWLifbdQ.js";import"./uuid-5hg4BtTT.js";var u=(r=>(r.DEBUG="DEBUG",r.INFO="INFO",r.WARN="WARN",r.ERROR="ERROR",r.TRACE="TRACE",r))(u||{});const _e=["onClick"],me=B({__name:"copier",props:{text:{}},setup(r){const{t:n}=W(),d=async()=>{J(r.text),await new Promise(c=>setTimeout(c,3e3))};return(c,e)=>{const h=ae,g=se,i=le;return p(),_(z,{once:"","async-fn":d},{default:a(({run:k,loading:m})=>[l(i,{content:f(n)(m?"copier.copied":"copier.copy")},{default:a(()=>[F("span",{class:Q(m?"arco-typography-operation-copied":"arco-typography-operation-copy"),onClick:k},[m?(p(),_(h,{key:0})):(p(),_(g,{key:1}))],10,_e)]),_:2},1032,["content"])]),_:1})}}});class ge{_isOpen=!1;get isOpen(){return this._isOpen}get State(){return this.ws?.readyState??WebSocket.CLOSED}ws;url;constructor(n,d,c){const e=new URL(n);this.url=new URL(A(`${e.protocol==="https:"?"wss":"ws"}://${e.host}${e.pathname}`,d)),this.url.searchParams.append("token",c)}open(n,d,c){try{this.ws?.close(),this.url.searchParams.append("offset",n.toString()),this.ws=new WebSocket(this.url),this.ws.onopen=()=>{this._isOpen=!0},this.ws.onerror=e=>{c(new Error(`WebSocket error: ${e}`))},this.ws.onclose=()=>{this._isOpen=!1},this.ws.onmessage=e=>{try{const h=JSON.parse(e.data);h.success?d(h.data):c(new Error(`WebSocket error: ${h.message}`))}catch{}}}catch(e){return e instanceof Error&&c(e),!1}return!0}close(){this._isOpen&&(this.ws?.close(),this.ws=void 0)}}class we extends ge{constructor(){const n=I();super(n.endpoint,"api/logs/stream",n.authToken)}}async function ye(){const r=I();await r.serverAvailable;const n=new URL(A(r.endpoint,"api/logs/history"),location.href);return fetch(n,{headers:M()}).then(d=>(r.assertResponseLogin(d),d.json()))}const ve={class:"hover-display-btn"},be=B({__name:"logViewer",setup(r){const{t:n,d}=W(),c=y(!0),e=X({hideThreads:[],autoScroll:!0,autoRefresh:!1,showLevel:{[u.TRACE]:!1,[u.DEBUG]:!1,[u.INFO]:!0,[u.WARN]:!0,[u.ERROR]:!0}}),h=N(()=>Array.from(g.value).map(o=>({value:o,tagProps:{color:O(o)}}))),g=y(new Set),i=y([]);Y(ye,{onSuccess:o=>{i.value.splice(0,i.value.length),i.value.push(...o.data),c.value=!1,o.data.forEach(s=>g.value.add(s.thread))}});const k=N(()=>i.value.filter(o=>e.showLevel[o.level]).filter(o=>!e.hideThreads.includes(o.thread))),m=y(),T=new we,$=async o=>{try{return o?T.open(i.value.length>0?i.value[i.value.length-1].offset:0,s=>{i.value.push(s),g.value.add(s.thread),e.autoScroll&&m.value?.scrollIntoView({index:i.value.length-1,align:"bottom"})},s=>{L.error(s.message),e.autoRefresh=!1}):(T.close(),!0)}catch(s){return s instanceof Error&&L.error(s.message),!1}},C=o=>{switch(o){case u.TRACE:return"blue";case u.WARN:return"orange";case u.ERROR:return"red";case u.DEBUG:case u.INFO:default:return"gray"}},O=o=>o.startsWith("virtual-")||o.startsWith("pool")||/Thread-[0-9]+/.test(o)?"gray":q(o,["orange","orangered","red","blue"]);Z(()=>{T.close()});const E=y(!0);return(o,s)=>{const V=ce,w=re,R=ue,S=ie,D=de,G=ne,P=fe,j=he,H=pe;return p(),_(S,{direction:"vertical",class:"container",size:"medium"},{default:a(()=>[l(G,{disabled:c.value,model:e,layout:"inline"},{default:a(()=>[l(w,{field:"autoRefresh",label:f(n)("page.settings.tab.info.log.enableAutoRefresh")},{default:a(()=>[l(V,{modelValue:e.autoRefresh,"onUpdate:modelValue":s[0]||(s[0]=t=>e.autoRefresh=t),"before-change":$},null,8,["modelValue"])]),_:1},8,["label"]),e.autoRefresh?(p(),_(w,{key:0,field:"autoScroll",label:f(n)("page.settings.tab.info.log.autoScorll")},{default:a(()=>[l(V,{modelValue:e.autoScroll,"onUpdate:modelValue":s[1]||(s[1]=t=>e.autoScroll=t)},null,8,["modelValue"])]),_:1},8,["label"])):U("",!0),l(w,{field:"showThreadName",label:f(n)("page.settings.tab.info.log.showThread")},{default:a(()=>[l(V,{modelValue:E.value,"onUpdate:modelValue":s[2]||(s[2]=t=>E.value=t)},null,8,["modelValue"])]),_:1},8,["label"]),l(w,{field:"showLevel",label:f(n)("page.settings.tab.info.log.showLevel")},{default:a(()=>[l(S,null,{default:a(()=>[(p(!0),ee(te,null,oe(Object.keys(e.showLevel),t=>(p(),_(R,{key:t,checked:e.showLevel[t],"onUpdate:checked":x=>e.showLevel[t]=x,color:C(t),checkable:""},{default:a(()=>[v(b(t),1)]),_:2},1032,["checked","onUpdate:checked","color"]))),128))]),_:1})]),_:1},8,["label"]),l(w,{field:"hideThreads",label:f(n)("page.settings.tab.info.log.hideThreads")},{default:a(()=>[l(D,{modelValue:e.hideThreads,"onUpdate:modelValue":s[3]||(s[3]=t=>e.hideThreads=t),placeholder:f(n)("page.settings.tab.info.log.hideThreads.placeholder"),style:{width:"15rem"},multiple:"","max-tag-count":1,"allow-create":"",scrollbar:"",options:h.value},null,8,["modelValue","placeholder","options"])]),_:1},8,["label"])]),_:1},8,["disabled","model"]),l(H,{ref_key:"logList",ref:m,size:"small",loading:c.value,scrollbar:"","virtual-list-props":{height:650,buffer:50},data:k.value},{item:a(({item:t,index:x})=>[(p(),_(j,{key:x},{default:a(()=>[l(S,{style:{display:"flex","justify-content":"space-between"},fill:"",class:"log-line-container"},{default:a(()=>[l(S,{class:"log-line"},{default:a(()=>[l(R,{class:"level-tag",color:C(t.level)},{default:a(()=>[v(b(t.level),1)]),_:2},1032,["color"]),l(R,null,{default:a(()=>[v(b(f(d)(t.time,"log")),1)]),_:2},1024),E.value?(p(),_(R,{key:0,color:O(t.thread)},{default:a(()=>[v(b(t.thread),1)]),_:2},1032,["color"])):U("",!0),l(P,{ellipsis:{rows:1,showTooltip:!0}},{default:a(()=>[v(b(t.content),1)]),_:2},1024)]),_:2},1024),F("div",ve,[l(me,{text:t.content},null,8,["text"])])]),_:2},1024)]),_:2},1024))]),_:1},8,["loading","data"])]),_:1})}}}),Ee=K(be,[["__scopeId","data-v-3ad7673d"]]);export{Ee as default};
