import{u as O,b as oe,c as se,I as G,f as P,h as de,_ as Z,d as _e,l as ge,i as me,e as fe}from"./index-DPhHiuup.js";import{f as q,a7 as J,a as C,ak as ee,s as y,t as e,y as t,v as i,x as s,a3 as a,a1 as W,m as X,u as he,j as Y,F as le,P as be,q as ie,k as d,c as V,w as ne}from"./libs-BYIN-Nlk.js";import{G as ye,a as ve,b as Se}from"./data-Czb_wvCh.js";import{_ as ce}from"./queryIpLink.vue_vue_type_script_setup_true_lang-BYzWFW1A.js";import{F as re,S as j,T as Q,t as te,e as ae,c as ze,E as we,a9 as Ie,K as Ce,a5 as Le,j as He,f as xe,as as Pe}from"./arcoDesign-CWLifbdQ.js";import{I as pe}from"./index-LMbWXuwu.js";import{I as ke}from"./index-D7HAnLk3.js";import"./uuid-5hg4BtTT.js";const $e=q({__name:"accessHistoryModal",setup(R,{expose:v}){const{t:p,d:l}=J(),L=O(),_=C(!1),g=C(""),H=C("");v({showModal:(r,c)=>{H.value=c,g.value=r,b({page:1,pageSize:10,infoHash:r}),_.value=!0}});const{data:S,total:B,current:z,loading:k,pageSize:h,changeCurrent:F,changePageSize:D,runAsync:b}=ee(ye,{pagination:{currentKey:"page",pageSizeKey:"pageSize",totalKey:"data.total"},manual:!0,cacheKey:r=>`${L.endpoint}-torrentAccessHistory-${r?.[0].infoHash}-${r?.[0].page||1}-${r?.[0].pageSize||10}`}),$=[{title:()=>p("page.torrentList.accessHistory.column.downloader"),slotName:"downloader"},{title:()=>p("page.torrentList.accessHistory.column.address"),slotName:"address"},{title:"Peer ID",slotName:"peerId"},{title:()=>p("page.torrentList.accessHistory.column.traffic"),slotName:"traffic",dataIndex:"uploaded",sortable:{sortDirections:["ascend","descend"],sorter:!0}},{title:()=>W(j,[p("page.torrentList.accessHistory.column.offset"),W(Ie,{content:p("page.torrentList.accessHistory.column.offsetDescription")},()=>W(G))]),slotName:"offset"},{title:"Flags",slotName:"flags"},{title:()=>p("page.torrentList.accessHistory.column.timeseen"),slotName:"time"}],N=r=>r.split(" ").map(c=>c+" - "+p("page.dashboard.peerList.column.flags."+c.trim())),T=(r,c)=>{b(c?{page:z.value,pageSize:h.value,infoHash:g.value,sorter:`${r}|${c}`}:{page:z.value,pageSize:h.value,infoHash:g.value})};return(r,c)=>{const w=ie("i18n-t"),u=Q,U=ze,I=ae,m=oe,x=se,f=j,E=te,A=we,K=re;return d(),y(K,{visible:_.value,"onUpdate:visible":c[0]||(c[0]=o=>_.value=o),"hide-cancel":"",closable:"","unmount-on-close":"",width:"auto"},{title:e(()=>[t(w,{keypath:"page.torrentList.accessHistory.title"},{name:e(()=>[i(s(H.value),1)]),_:1})]),default:e(()=>[t(f,{direction:"vertical",fill:""},{default:e(()=>[t(u,{style:{"font-size":"1.2em"}},{default:e(()=>[i(s(a(p)("page.torrentList.accessHistory.description")),1)]),_:1}),a(S)?.data.results||a(k)?(d(),y(E,{key:0,stripe:!0,columns:$,data:a(S)?.data.results,loading:a(k),pagination:{total:a(B),current:a(z),pageSize:a(h),showPageSize:!0,baseSize:4,bufferSize:1},"column-resizable":"",size:"medium",class:"banlog-table",onPageChange:a(F),onSorterChange:T,onPageSizeChange:a(D)},{address:e(({record:o})=>[t(u,{code:"",copyable:"",style:{"white-space":"nowrap"}},{default:e(()=>[t(ce,{ip:o.address,style:{color:"var(--color-text-2)"}},{default:e(()=>[i(s(o.address),1)]),_:2},1032,["ip"])]),_:2},1024)]),downloader:e(({record:o})=>[t(U,{color:a(de)(o.downloader.id)},{default:e(()=>[i(s(o.downloader.name),1)]),_:2},1032,["color"])]),peerId:e(({record:o})=>[X("p",null,[i(s(o.peerId?o.peerId:a(p)("page.banlist.banlist.listItem.empty"))+" ",1),t(I,{content:o.clientName?o.clientName:a(p)("page.banlist.banlist.listItem.empty")},{default:e(()=>[t(a(G))]),_:2},1032,["content"])])]),traffic:e(({record:o})=>[t(f,{fill:"",direction:"vertical"},{default:e(()=>[t(u,null,{default:e(()=>[t(m,{class:"green"}),i(" "+s(a(P)(o.uploaded)),1)]),_:2},1024),t(u,null,{default:e(()=>[t(x,{class:"red"}),i(" "+s(a(P)(o.downloaded)),1)]),_:2},1024)]),_:2},1024)]),offset:e(({record:o})=>[t(f,{fill:"",direction:"vertical"},{default:e(()=>[t(u,null,{default:e(()=>[t(m,{class:"green"}),i(" "+s(a(P)(o.uploadedOffset)),1)]),_:2},1024),t(u,null,{default:e(()=>[t(x,{class:"red"}),i(" "+s(a(P)(o.downloadedOffset)),1)]),_:2},1024)]),_:2},1024)]),flags:e(({record:o})=>[X("p",null,[i(s(o.lastFlags)+" ",1),o.lastFlags?(d(),y(I,{key:0},{content:e(()=>[(d(!0),Y(le,null,be(N(o.lastFlags),M=>(d(),Y("p",{key:M},s(M),1))),128))]),default:e(()=>[t(a(G))]),_:2},1024)):he("",!0)])]),time:e(({record:o})=>[t(f,{fill:"",direction:"vertical"},{default:e(()=>[t(u,null,{default:e(()=>[i(s(a(p)("page.torrentList.accessHistory.column.timeseen.first"))+": "+s(a(l)(o.firstTimeSeen,"long")),1)]),_:2},1024),t(u,null,{default:e(()=>[i(s(a(p)("page.torrentList.accessHistory.column.timeseen.last"))+": "+s(a(l)(o.lastTimeSeen,"long")),1)]),_:2},1024)]),_:2},1024)]),_:1},8,["data","loading","pagination","onPageChange","onPageSizeChange"])):(d(),y(A,{key:1,style:{height:"20vh","align-items":"center",display:"flex","justify-content":"center","flex-direction":"column"}},{default:e(()=>[i(s(a(p)("page.torrentList.accessHistory.empty")),1)]),_:1}))]),_:1})]),_:1},8,["visible"])}}}),Ne=Z($e,[["__scopeId","data-v-f8b10164"]]),Te=q({__name:"banHistoryModal",setup(R,{expose:v}){const p=O(),{t:l,d:L}=J(),_=C(!1),g=C(""),H=C("");v({showModal:(r,c)=>{g.value=c,H.value=r,b({page:1,pageSize:10,infoHash:r}),_.value=!0}});const{data:S,total:B,current:z,loading:k,pageSize:h,changeCurrent:F,changePageSize:D,runAsync:b}=ee(ve,{manual:!0,pagination:{currentKey:"page",pageSizeKey:"pageSize",totalKey:"data.total"},cacheKey:r=>`${p.endpoint}-torrentBanHistory-${r?.[0].infoHash}-${r?.[0].page||1}-${r?.[0].pageSize||10}`}),$=[{title:()=>l("page.banlog.banlogTable.column.banTime")+"/"+l("page.banlog.banlogTable.column.unbanTime"),slotName:"banAt",width:210},{title:()=>l("page.banlog.banlogTable.column.peerAddress"),slotName:"peerAddress",width:200},{title:()=>l("page.banlog.banlogTable.column.peerId"),slotName:"peerId",width:120},{title:()=>l("page.banlog.banlogTable.column.trafficSnapshot"),slotName:"peerStatus",dataIndex:"peerUploaded",sortable:{sortDirections:["ascend","descend"],sorter:!0},width:150},{title:()=>l("page.banlog.banlogTable.column.description"),dataIndex:"description",ellipsis:!0,tooltip:!0}],N=(r,c)=>{b(c?{page:z.value,pageSize:h.value,infoHash:H.value,sorter:`${r}|${c}`}:{page:z.value,pageSize:h.value,infoHash:H.value})},T=V(()=>S.value?.data.results);return(r,c)=>{const w=ie("i18n-t"),u=Q,U=pe,I=Le,m=j,x=oe,f=se,E=Ce,A=ae,K=G,o=te,M=re;return d(),y(M,{visible:_.value,"onUpdate:visible":c[0]||(c[0]=n=>_.value=n),"hide-cancel":"",closable:"","unmount-on-close":"",width:"auto"},{title:e(()=>[t(w,{keypath:"page.torrentList.banHistory.title"},{name:e(()=>[i(s(g.value),1)]),_:1})]),default:e(()=>[t(m,{direction:"vertical",fill:"",style:{"max-width":"1400px"}},{default:e(()=>[t(u,{style:{"font-size":"1.2em"}},{default:e(()=>[i(s(a(l)("page.torrentList.banHistory.description")),1)]),_:1}),t(o,{stripe:!0,columns:$,data:T.value,loading:a(k),pagination:{total:a(B),current:a(z),pageSize:a(h),showPageSize:!0,baseSize:4,bufferSize:1},"column-resizable":"",size:"medium",onPageChange:a(F),onSorterChange:N,onPageSizeChange:a(D)},{banAt:e(({record:n})=>[t(m,{fill:"",direction:"vertical"},{default:e(()=>[t(u,null,{default:e(()=>[t(U),i(" "+s(a(L)(n.banAt,"long")),1)]),_:2},1024),t(u,null,{default:e(()=>[t(I),i(" "+s(n.unbanAt?a(L)(n.unbanAt,"long"):a(l)("page.banlog.banlogTable.notUnbanned")),1)]),_:2},1024)]),_:2},1024)]),peerAddress:e(({record:n})=>[t(u,{code:""},{default:e(()=>[t(ce,{ip:n.peerIp,style:{color:"var(--color-text-2)"}},{default:e(()=>[i(s(a(_e)(n.peerIp,n.peerPort)),1)]),_:2},1032,["ip"])]),_:2},1024)]),peerStatus:e(({record:n})=>[t(m,{fill:"",style:{"justify-content":"space-between"}},{default:e(()=>[t(m,{fill:"",direction:"vertical"},{default:e(()=>[t(u,null,{default:e(()=>[t(x,{class:"green"}),i(" "+s(a(P)(n.peerUploaded)),1)]),_:2},1024),t(u,null,{default:e(()=>[t(f,{class:"red"}),i(" "+s(a(P)(n.peerDownloaded)),1)]),_:2},1024)]),_:2},1024),t(A,{content:(n.peerProgress*100).toFixed(2)+"%"},{default:e(()=>[t(E,{percent:n.peerProgress,size:"mini"},null,8,["percent"])]),_:2},1032,["content"])]),_:2},1024)]),peerId:e(({record:n})=>[X("p",null,[i(s(n.peerId?n.peerId:a(l)("page.banlist.banlist.listItem.empty"))+" ",1),t(A,{content:n.peerClientName?n.peerClientName:a(l)("page.banlist.banlist.listItem.empty")},{default:e(()=>[t(K)]),_:2},1032,["content"])])]),_:1},8,["data","loading","pagination","onPageChange","onPageSizeChange"])]),_:1})]),_:1},8,["visible"])}}}),Ae=Z(Te,[["__scopeId","data-v-99974867"]]),Ke=q({__name:"torrentTable",setup(R){const v=C(!0),p=O(),{t:l}=J(),{data:L,total:_,current:g,loading:H,pageSize:S,changeCurrent:B,changePageSize:z,refresh:k,run:h}=ee(Se,{defaultParams:[{page:1,pageSize:10}],pagination:{currentKey:"page",pageSizeKey:"pageSize",totalKey:"data.total"},cacheKey:w=>`${p.endpoint}-torrentInfoList-${w?.[0].page||1}-${w?.[0].pageSize||10}`,onAfter:()=>{v.value=!1}},[fe]);ne([S,g],()=>{v.value=!0}),ne(()=>p.endpoint,k);const F=V(()=>v.value||H.value||!b.value),D=[{title:()=>l("page.torrentList.column.name"),dataIndex:"name",ellipsis:!0,tooltip:!0,width:500},{title:"Hash",slotName:"hash",width:340},{title:()=>l("page.torrentList.column.size"),slotName:"size",width:120},{title:()=>l("page.torrentList.column.count"),slotName:"count"},{title:()=>l("page.torrentList.column.actions"),slotName:"action"}],b=V(()=>L.value?.data.results),$=C(),N=C(),T=ge.debounce(w=>{h({page:g.value,pageSize:S.value,keyword:w})},300),r=O(),c=V(()=>r.plusStatus);return(w,u)=>{const U=He,I=j,m=Q,x=pe,f=ae,E=Pe,A=me,K=ke,o=xe,M=te;return d(),Y(le,null,[t(I,{direction:"vertical",fill:""},{default:e(()=>[t(I,{class:"align-right",fill:""},{default:e(()=>[t(U,{style:{width:"250px"},placeholder:a(l)("page.torrentList.accessHistory.searchPlaceholder"),"allow-clear":"","search-button":"",onSearch:a(T),onChange:a(T),onClear:u[0]||(u[0]=n=>a(h)({page:a(g),pageSize:a(S)}))},null,8,["placeholder","onSearch","onChange"])]),_:1}),t(M,{stripe:!0,columns:D,data:b.value,loading:F.value,pagination:{total:a(_),current:a(g),pageSize:a(S),showPageSize:!0,baseSize:4,bufferSize:1},"column-resizable":"",size:"medium",class:"banlog-table",onPageChange:a(B),onPageSizeChange:a(z)},{size:e(({record:n})=>[i(s(a(P)(n.size)),1)]),hash:e(({record:n})=>[t(m,{code:"",style:{"white-space":"nowrap"}},{default:e(()=>[i(s(n.infoHash),1)]),_:2},1024)]),count:e(({record:n})=>[t(I,{fill:"",direction:"vertical"},{default:e(()=>[t(f,{content:`${a(l)("page.torrentList.column.count.ban")}: ${n.peerBanCount}`},{default:e(()=>[t(m,null,{default:e(()=>[t(x),i(" "+s(n.peerBanCount),1)]),_:2},1024)]),_:2},1032,["content"]),t(f,{content:`${a(l)("page.torrentList.column.count.access")}: ${n.peerAccessCount}`},{default:e(()=>[t(m,null,{default:e(()=>[t(E),i(" "+s(n.peerAccessCount),1)]),_:2},1024)]),_:2},1032,["content"])]),_:2},1024)]),action:e(({record:n})=>[t(I,{wrap:""},{default:e(()=>[t(f,{content:c.value?.activated?a(l)("page.torrentList.column.actions.history"):a(l)("page.ipList.plusLock"),position:"top",mini:""},{default:e(()=>[t(o,{class:"edit-btn",shape:"circle",type:"text",disabled:!c.value?.activated,onClick:ue=>$.value?.showModal(n.infoHash,n.name)},{icon:e(()=>[c.value?.activated?(d(),y(A,{key:0})):(d(),y(K,{key:1}))]),_:2},1032,["disabled","onClick"])]),_:2},1032,["content"]),t(f,{content:c.value?.activated?a(l)("page.torrentList.column.actions.ban"):a(l)("page.ipList.plusLock"),position:"top",mini:""},{default:e(()=>[t(o,{class:"edit-btn",shape:"circle",type:"text",disabled:!c.value?.activated,onClick:ue=>N.value?.showModal(n.infoHash,n.name)},{icon:e(()=>[c.value?.activated?(d(),y(x,{key:0})):(d(),y(K,{key:1}))]),_:2},1032,["disabled","onClick"])]),_:2},1032,["content"])]),_:2},1024)]),_:1},8,["data","loading","pagination","onPageChange","onPageSizeChange"])]),_:1}),t(Ne,{ref_key:"accessHistoryModal",ref:$},null,512),t(Ae,{ref_key:"banHistoryModal",ref:N},null,512)],64)}}}),Me=Z(Ke,[["__scopeId","data-v-98f3a2b9"]]),Oe=q({__name:"index",setup(R){const{t:v}=J();return(p,l)=>{const L=Q,_=j;return d(),y(_,{direction:"vertical",fill:""},{default:e(()=>[t(L,{style:{"font-size":"1.2em"}},{default:e(()=>[i(s(a(v)("page.torrentList.description")),1)]),_:1}),t(Me)]),_:1})}}});export{Oe as default};
